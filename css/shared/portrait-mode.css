/* === Portrait Mode Responsive Adjustments ===
 * Mobile-first portrait orientation overrides.
 * Includes safe area handling for iPhone notch/home indicator.
 */

@media (orientation: portrait) {
    /* Larger text for portrait/mobile - easier to read on phones */
    :root {
        --base-font-size-fallback: 1.5rem;
        --base-font-size: clamp(1.25rem, 4vw, 1.75rem);
        --story-font-size: 1.4rem;
    }

    #text-box {
        max-height: 75% !important;
    }

    #text-box.ending-scene {
        max-height: 90% !important;
    }

    /* Fix banner/controls overlap in portrait mode */
    #text-box-header {
        flex-direction: column !important;
        padding: 4px 8px !important;
    }

    /* Title no longer needs absolute positioning in stacked layout */
    #text-box-title {
        position: static !important;
        transform: none !important;
        max-width: 100% !important;
        order: 1;
        margin-bottom: 4px;
    }

    /* Hide the spacer in portrait - not needed with stacked layout */
    #header-spacer {
        display: none !important;
    }

    /* Controls go below the title */
    #text-controls {
        order: 2;
        justify-content: center !important;
        width: 100%;
    }

    /* Hide volume slider in portrait - phones have hardware volume */
    #volume-slider {
        display: none !important;
    }

    /* 9:16 aspect ratio for portrait, 80% height with bottom padding */
    #vn-container,
    #password-container {
        width: 100% !important;
        max-width: 100% !important;
        aspect-ratio: 9 / 16 !important;
        max-height: 80vh !important;
        margin-bottom: 10vh !important;
    }

    /* Dev mode panel - hidden by default in portrait, toggle on tap */
    #theme-selector {
        display: none !important;
        top: 50px !important;
        right: 5px !important;
        max-width: calc(100vw - 20px) !important;
    }

    #theme-selector.portrait-expanded {
        display: block !important;
    }

    /* Dev mode indicator becomes a toggle button in portrait */
    #dev-mode-indicator {
        cursor: pointer !important;
        user-select: none !important;
    }

    #dev-mode-indicator::after {
        content: ' ▼';
        font-size: 10px;
    }

    #dev-mode-indicator.expanded::after {
        content: ' ▲';
    }

    /* Reset button to top-left in portrait */
    #reset-btn {
        top: var(--space-md) !important;
        bottom: auto !important;
        left: var(--space-md) !important;
        right: auto !important;
        /* Safe area for iPhone notch */
        top: max(var(--space-md), env(safe-area-inset-top, var(--space-md))) !important;
        left: max(var(--space-md), env(safe-area-inset-left, var(--space-md))) !important;
    }

    /* Battle stats panels - smaller on portrait */
    .battle-stats-panel {
        min-width: 7rem !important;
        max-width: 9rem !important;
        width: auto !important;
        padding: 0.4rem 0.5rem !important;
        font-size: 0.7rem !important;
    }

    /* Stack header vertically: name on top, AC below */
    .battle-stats-panel .stats-header {
        flex-direction: column !important;
        align-items: flex-start !important;
        font-size: 0.65rem !important;
        margin-bottom: 0.3rem !important;
        gap: 0.1rem !important;
    }

    /* AC display on its own line in portrait */
    .battle-stats-panel .stats-header .ac-display {
        margin-left: 0 !important;
        text-align: left !important;
        font-size: 0.55rem !important;
    }

    /* Hide status icon slot in portrait - too cramped */
    .battle-stats-panel .status-icon-slot {
        display: none !important;
    }

    .battle-stats-panel .stat-row {
        margin-bottom: 0.2rem !important;
    }

    .battle-stats-panel .stat-label {
        font-size: 0.5rem !important;
        min-width: 1rem !important;
    }

    .battle-stats-panel .stat-bar-outer {
        height: 0.5rem !important;
    }

    .battle-stats-panel .stat-value {
        font-size: 0.45rem !important;
        min-width: 1.5rem !important;
    }

    /* Player stats - position higher to avoid text box overlap */
    .battle-stats-panel.player-stats {
        bottom: calc(var(--battle-log-height) + 0.9375rem) !important;
        left: 0.3125rem !important;
    }

    /* Enemy stats - smaller gap from top */
    .battle-stats-panel.enemy-stats {
        top: 0.3125rem !important;
        right: 0.3125rem !important;
    }

    /* Safe area padding for iPhone home indicator */
    .battle-log-panel {
        padding-bottom: max(8px, env(safe-area-inset-bottom, 8px)) !important;
    }

    #text-box {
        padding-bottom: max(8px, env(safe-area-inset-bottom, 8px)) !important;
    }

    /* VN container safe area margins */
    #vn-container {
        padding-bottom: env(safe-area-inset-bottom, 0) !important;
    }
}

/* === Player Row Container (Portrait Mode) ===
 * In portrait, player stats and player summon sit side-by-side in a flex row
 * above the battle log. This guarantees perfect alignment.
 */

/* === Row Containers (Both Orientations) ===
 * Player row: stats panel + summon slot (stacked vertically in landscape, horizontal in portrait)
 * Enemy row: summon slot + stats panel (stacked vertically in landscape, horizontal in portrait)
 */

/* LANDSCAPE: Vertical flex columns anchored to corners */
.player-row {
    display: flex;
    flex-direction: column-reverse; /* Summon above stats (bottom-anchored, so reverse) */
    align-items: center; /* Center summon over stats panel */
    position: absolute;
    left: var(--ui-edge-margin);
    bottom: calc(var(--battle-log-height) + 0.5rem);
    z-index: var(--z-battle-ui);
    gap: 0.5rem;
}

.enemy-row {
    display: flex;
    flex-direction: column-reverse; /* Stats on top, summon below (top-anchored, so reverse) */
    align-items: center; /* Center summon under stats panel */
    position: absolute;
    right: var(--ui-edge-margin);
    top: var(--ui-edge-margin);
    z-index: var(--z-battle-ui);
    gap: 0.5rem;
}

/* Stats panels flow in flex - no absolute positioning needed */
.player-row .battle-stats-panel.player-stats,
.enemy-row .battle-stats-panel.enemy-stats {
    position: static !important;
    top: auto !important;
    right: auto !important;
    bottom: auto !important;
    left: auto !important;
}

/* Summon slots visible and flow in flex */
.player-summon-slot,
.enemy-summon-slot {
    display: flex;
    gap: 0.5rem;
}

/* Player summon slot: align summons to left */
.player-summon-slot {
    align-items: flex-end;
    flex-direction: row;
}

/* Enemy summon slot: align summons to right */
.enemy-summon-slot {
    align-items: flex-start;
    flex-direction: row;
}

/* Summons inside slots don't need absolute positioning */
.player-summon-slot .summon-container,
.enemy-summon-slot .summon-container {
    position: static !important;
    transform: none !important;
}

/* PORTRAIT: Override to horizontal layout spanning full width */
@media (orientation: portrait) {
    :root {
        /* Use smaller margins in portrait */
        --ui-edge-margin: var(--ui-edge-margin-small);
    }

    /* Player row: horizontal, spans width, above battle log */
    .player-row {
        flex-direction: row;
        justify-content: space-between;
        align-items: flex-end;
        left: 0.3125rem;
        right: 0.3125rem;
        bottom: calc(var(--battle-log-height) + 0.5rem);
        top: auto;
    }

    /* Enemy row: horizontal, spans width, at top */
    .enemy-row {
        flex-direction: row;
        justify-content: space-between;
        align-items: flex-start;
        left: 0.3125rem;
        right: 0.3125rem;
        top: 0.3125rem;
        bottom: auto;
    }

    /* Smaller summons in portrait mode to avoid overlap with stats panel */
    .summon-sprite-wrapper {
        width: 3rem !important;
    }

    .summon-info-badge {
        font-size: 0.55rem !important;
        padding: 0.15rem 0.35rem !important;
    }

    /* Ensure gap between stats and summon */
    .player-row,
    .enemy-row {
        gap: 0.25rem;
    }
}

/* MOBILE LANDSCAPE: No special adjustments needed - flex containers handle alignment */

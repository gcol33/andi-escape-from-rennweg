/* === Portrait Mode Responsive Adjustments ===
 * Mobile-first portrait orientation overrides.
 * Includes safe area handling for iPhone notch/home indicator.
 */

@media (orientation: portrait) {
    /* Larger text for portrait/mobile - easier to read on phones */
    :root {
        --base-font-size-fallback: 1.5rem;
        --base-font-size: clamp(1.25rem, 4vw, 1.75rem);
        --story-font-size: 1.4rem;
    }

    #text-box {
        max-height: 75% !important;
    }

    #text-box.ending-scene {
        max-height: 90% !important;
    }

    /* Fix banner/controls overlap in portrait mode */
    #text-box-header {
        flex-direction: column !important;
        padding: 4px 8px !important;
    }

    /* Title no longer needs absolute positioning in stacked layout */
    #text-box-title {
        position: static !important;
        transform: none !important;
        max-width: 100% !important;
        order: 1;
        margin-bottom: 4px;
    }

    /* Hide the spacer in portrait - not needed with stacked layout */
    #header-spacer {
        display: none !important;
    }

    /* Controls go below the title */
    #text-controls {
        order: 2;
        justify-content: center !important;
        width: 100%;
    }

    /* Hide volume slider in portrait - phones have hardware volume */
    #volume-slider {
        display: none !important;
    }

    /* 9:16 aspect ratio for portrait, 80% height with bottom padding */
    #vn-container,
    #password-container {
        width: 100% !important;
        max-width: 100% !important;
        aspect-ratio: 9 / 16 !important;
        max-height: 80vh !important;
        margin-bottom: 10vh !important;
    }

    /* Dev mode panel - hidden by default in portrait, toggle on tap */
    #theme-selector {
        display: none !important;
        top: 50px !important;
        right: 5px !important;
        max-width: calc(100vw - 20px) !important;
    }

    #theme-selector.portrait-expanded {
        display: block !important;
    }

    /* Dev mode indicator becomes a toggle button in portrait */
    #dev-mode-indicator {
        cursor: pointer !important;
        user-select: none !important;
    }

    #dev-mode-indicator::after {
        content: ' ▼';
        font-size: 10px;
    }

    #dev-mode-indicator.expanded::after {
        content: ' ▲';
    }

    /* Reset button to top-left in portrait */
    #reset-btn {
        top: 10px !important;
        bottom: auto !important;
        left: 10px !important;
        right: auto !important;
        /* Safe area for iPhone notch */
        top: max(10px, env(safe-area-inset-top, 10px)) !important;
        left: max(10px, env(safe-area-inset-left, 10px)) !important;
    }

    /* Battle stats panels - smaller on portrait */
    .battle-stats-panel {
        min-width: 8.75rem !important;
        padding: 0.5rem 0.625rem !important;
        font-size: 0.8rem !important;
    }

    .battle-stats-panel .stats-header {
        font-size: 0.7rem !important;
        margin-bottom: 0.375rem !important;
    }

    .battle-stats-panel .stat-row {
        margin-bottom: 0.25rem !important;
    }

    .battle-stats-panel .stat-label {
        font-size: 0.6rem !important;
        min-width: 1.125rem !important;
    }

    .battle-stats-panel .stat-bar-outer {
        height: 0.625rem !important;
    }

    .battle-stats-panel .stat-value {
        font-size: 0.55rem !important;
        min-width: 1.875rem !important;
    }

    /* Player stats - position higher to avoid text box overlap */
    .battle-stats-panel.player-stats {
        bottom: calc(var(--battle-log-height) + 0.9375rem) !important;
        left: 0.3125rem !important;
    }

    /* Enemy stats - smaller gap from top */
    .battle-stats-panel.enemy-stats {
        top: 0.3125rem !important;
        right: 0.3125rem !important;
    }

    /* Safe area padding for iPhone home indicator */
    .battle-log-panel {
        padding-bottom: max(8px, env(safe-area-inset-bottom, 8px)) !important;
    }

    #text-box {
        padding-bottom: max(8px, env(safe-area-inset-bottom, 8px)) !important;
    }

    /* VN container safe area margins */
    #vn-container {
        padding-bottom: env(safe-area-inset-bottom, 0) !important;
    }
}

/* === UI Positioning Overrides for Portrait ===
 * Must come AFTER all :root definitions
 */
@media (orientation: portrait) {
    :root {
        /* Use smaller margins in portrait */
        --ui-edge-margin: var(--ui-edge-margin-small);

        /* Player summon: RIGHT side, bottom-aligned with player stats */
        --player-summon-left: auto;
        --player-summon-right: var(--ui-edge-margin);
        --player-summon-top: auto;
        --player-summon-bottom: calc(var(--battle-log-height) + 0.9375rem);
        --player-summon-transform: none;

        /* Enemy summon: LEFT side, top area */
        --enemy-summon-left: var(--ui-edge-margin);
        --enemy-summon-right: auto;
        --enemy-summon-top: 15%;
        --enemy-summon-transform: none;
    }
}

/* MOBILE LANDSCAPE: Adjust for smaller stats panels */
@media (max-width: 37.5rem) and (orientation: landscape) {
    :root {
        /* Smaller stats panels = different centering */
        --player-summon-left: calc(var(--ui-edge-margin-small) + var(--stats-panel-width-mobile) / 2);
        --player-summon-top: 25%;
        --enemy-summon-right: calc(var(--ui-edge-margin-small) + var(--stats-panel-width-mobile) / 2);
        --enemy-summon-top: 25%;
    }
}

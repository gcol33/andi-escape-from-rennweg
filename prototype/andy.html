<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andy's Last Day - Social Delays</title>
    
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f2e7d5;
            color: #4b3e2a;
            max-width: 700px;
            margin: 40px auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #5c4732;
            text-align: center;
        }
        #story-output {
            margin: 20px 0;
            padding: 15px;
            background-color: #faf1e0;
            border: 1px solid #d3c2a8;
            border-radius: 4px;
            line-height: 1.6;
        }
        .choice-button {
            display: block;
            width: 100%;
            margin-top: 10px;
            padding: 12px;
            background-color: #b08b5a;
            color: #fffbe9;
            border: none;
            border-radius: 4px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .choice-button:hover {
            background-color: #8f6f46;
        }
        .game-over {
            color: #4b1f0d;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
            border: 2px solid #4b1f0d;
            padding: 10px;
            border-radius: 5px;
        }
        .dice-roll {
            font-size: 1.1em;
            color: #b08b5a;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    
    <h1>Andy's Farewell</h1>
    
    <div id="story-output"></div>
    <div id="choices-container"></div>
    
    <script>
        // --- GAME DATA STRUCTURE ---
        const gameData = {
            'start': {
                text: "The old wooden door closes with a dull thud behind you for the very last time. Your badge no longer works; your desk is empty. You stand in the dim hallway of the 1st floor, where scuffed tile stretches ahead and the overhead fluorescents hum their familiar drone. Your new job starts Monday, and this chapter is finally closed. Now, you just need to get to the entrance and head out to freedom.",
                choices: [
                    { text: "Turn right and take the main stairs down to the entrance.", target: 'main_stairs' },
                    { text: "Turn left and take the back stairs to the main entrance.", target: 'back_stairs' },
                    { text: "Get one last, sentimental cup of coffee in the kitchen near your office.", target: 'coffee_kitchen' }
                ]
            },
            
            // --- MAIN STAIRS (AGNES'S TRAP) PATH ---
            'main_stairs': {
                text: "You turn right and walk toward the main stairwell. Just as you reach the landing, Agnes from HR steps out, blocking your path. She holds a single, thick manila envelope and smiles a very thin smile. 'Andy. Perfect timing. Just a quick document I need you to sign before you are officially off the premises. Standard exit protocol.'",
                choices: [
                    { text: "Sign the document without reading it.", target: 'document_signed' },
                    { text: "Refuse to sign and ask what it is.", target: 'document_refusal' },
                    { text: "Try to walk around Agnes, pretending not to hear.", target: 'attempt_pass' } 
                ]
            },

            'document_signed': {
                text: "You sigh, scribble your signature on the last page of the dense legal document, and hand the pen back to Agnes. 'All done, Andy! Best of luck,' she chirps. You are now free to take the stairs down, feeling only slightly heavier.",
                choices: [
                    { text: "Scramble down the main stairs to the entrance.", target: 'exit_lobby' }
                ]
            },

            'document_refusal': {
                text: "You politely (or rudely) refuse to sign. Agnes's smile vanishes, replaced by an expression of cold, professional disapproval. She snaps her fingers. Suddenly, the hallway lights turn bright red, and a piercing alarm sounds. A robotic voice booms: **'TERMINATION PROTOCOL ALPHA-SEVEN INITIATED. MEMORY BLOCK COMMENCING.'** A wave of nausea hits you, and all thoughts of your new job vanish. You are instantly re-employed.",
                choices: [
                    { text: "Collapse into the carpet, your future erased.", target: 'lost_to_HR' }
                ]
            },
            
            // --- D20 ROLL PATH ---
            'attempt_pass': {
                text: "You mutter a quick 'Gotta run!' and try to dart past Agnes. You are fast, but Agnes is known to have a hidden history as a competitive ballroom dancer. **You must roll a d20 (13 or lower to succeed).**",
                choices: [
                    { text: "ROLL D20...", target: 'perform_d20_roll' }
                ]
            },
            
            'd20_success': {
                text: "You weren't fast enough to catch her completely off guard, but you saw the movement! Agnes stretches her leg in a lightning-fast trip move. In a moment of great sportiveness (you? REALLY?), you leap over her extended foot with a surprising burst of agility and get a clean run to the main stairs!",
                choices: [
                    { text: "Scramble down the main stairs to the entrance.", target: 'exit_lobby' }
                ]
            },

            'd20_failure': {
                text: "You moved very fast, but Agnes is faster. Her leg snaps out with precision, and you trip, falling face down onto the carpet. The wind is knocked out of you. Agnes calmly stands over you, holding the manila folder. Before you can protest, she presses a button on her watch. The hallway lights dim. You wake up chained to your old desk.",
                choices: [
                    { text: "The long-term employment trap has sprung.", target: 'lost_to_coffee' }
                ]
            },

            // --- LEFT TURN PATH (COLLEAGUES) ---
            'back_stairs': {
                text: "You turn left toward the back stairwell, but before you reach it, you hear a frantic whispering from the office next door. Two colleagues, Joni and Norbert, step out, looking desperate. Joni is frantically clutching a printed thesis draft. 'Andy! Thank God! You're the only one who knows the Bayesian Multi-Variate Regression with Inverse Propensity Weighting. My PhD submission is today, and it just crashed! Please, you have to help me!'",
                choices: [
                    { text: "Option 1: Sit at the desk and help them fix the model.", target: 'lost_to_PhD' },
                    { text: "Option 2: Say, 'Sorry, guys, I'm out of here. Good luck.'", target: 'colleague_plea' },
                    { text: "Option 3: Say, 'FUCK OFF.'", target: 'corridor_safe' }
                ]
            },

            'colleague_plea': {
                text: "Norbert grabs your sleeve. 'Please, Andy! Five minutes! You were always the best! If Joni misses the deadline, he loses everything!'",
                choices: [
                    { text: "Agree: 'Fine, five minutes.'", target: 'lost_to_PhD' },
                    { text: "Refuse again: 'No, I really have to go.'", target: 'corridor_delayed' } // New branch
                ]
            },
            
            // --- NEW DELAY BRANCH ---
            'corridor_delayed': {
                text: "You shake off Joni and step firmly into the corridor, only to be immediately intercepted by Fabio and Ali. 'Andy! Leaving already? Just wanted to say hello and wish you luck!'. After a few minutes of pleasantries, Ali adds, 'Oh, you didn't say bye to the fourth floor folks, did you? Michi, Gilles, and Ruling will never forgive you!'",
                choices: [
                    { text: "Agree to take the elevator up to the 4th floor.", target: 'fourth_floor_elevator' },
                    { text: "Say 'I don't have time!' and run for the stairs.", target: 'corridor_safe' }
                ]
            },

            'fourth_floor_elevator': {
                text: "You agree and press the '4' button. The ride down is silent. When the doors open, Michi, Gilles, and Ruling are there, ready to ambush you with a whiteboard. You spend the next two agonizing hours discussing the optimal parameters for a highly complex, niche model. Your resolve slowly erodes.",
                choices: [
                    { text: "Finally manage to break free and get back on the elevator.", target: 'exit_lobby' }
                ]
            },

            // --- COFFEE (THE SPIKE) PATH ---
            'coffee_kitchen': {
                text: "You step into the kitchen. It is eerily quiet. The coffee machine is running, smelling comfortingly familiar. You quickly pour a mug. The coffee tastes strangely sweet, but you drink it down anyway. You lean against the counter, feeling satisfied... and suddenly, incredibly drowsy.",
                choices: [
                    { text: "The room is spinning. You close your eyes.", target: 'lost_to_coffee' }
                ]
            },

            // --- GAME OVER STATES ---
            'lost_to_HR': {
                text: "You wake up in your apartment, startled. The clock says 7:00 AM. You feel an inexplicable dread about the long commute ahead of you. You remember nothing about a 'new job' or a 'last day.' You are stuck in an endless loop of yesterday. **You lost the game.**",
                choices: []
            },
            'lost_to_coffee': {
                text: "You wake up with a throbbing headache. You are chained to your old desk chair. The office is dark, except for the flickering screen of a monitor displaying a perpetual 'System Update' message. You realize you have been working here, unknowingly, for a very long time. **You lost the game.**",
                choices: []
            },
            'lost_to_PhD': {
                text: "You sit down and dive into the code. The problem is deep, fascinating, and consumes your entire focus. You hear the door swing shut, but you don't look up. You solve the bug, then another, and another. Next time you check the time, the digital clock reads: **2035**. You cannot remember the names of the people who asked you for help. You have merged with the job. **You lost the game.**",
                choices: []
            },
            
            // --- EXIT PATHS ---
            'corridor_safe': {
                text: "Ignoring their desperate pleas, you walk past your former colleagues. The hallway feels heavy with their disappointment, but you continue toward the dimly lit back stairwell. It smells faintly of dust and cleaning supplies. You enjoy the silence of your final moments in the building.",
                choices: [
                    { text: "Continue down to the main entrance.", target: 'exit_lobby' }
                ]
            },
            'exit_lobby': {
                text: "You reach the main lobby. The security guard waves you goodbye. You push open the heavy front doors and step out onto the street. The sun is shining. The chapter is closed. **YOU WIN.**",
                choices: []
            }
        };

        // --- GAME LOGIC FUNCTIONS ---
        
        /**
         * Simulates a d20 roll and directs the player to success or failure node.
         */
        function perform_d20_roll() {
            // Generates a random integer from 1 to 20
            const roll = Math.floor(Math.random() * 20) + 1; 
            const successThreshold = 13; // Roll of 13 or lower succeeds

            let resultText = `<div class="dice-roll">You rolled a d20 and got: **${roll}**!</div>`;
            
            if (roll <= successThreshold) {
                // SUCCESS: Roll is 13 or lower
                updatePage('d20_success', resultText);
            } else {
                // FAILURE: Roll is above 13
                updatePage('d20_failure', resultText);
            }
        }

        /**
         * Updates the page content based on the given section ID.
         * @param {string} sectionId - The key for the gameData section to load.
         * @param {string} [prependContent=''] - Optional content (like the dice roll result) to add before the story text.
         */
        function updatePage(sectionId, prependContent = '') {
            if (sectionId === 'perform_d20_roll') {
                perform_d20_roll();
                return;
            }

            const section = gameData[sectionId];
            const storyOutput = document.getElementById('story-output');
            const choicesContainer = document.getElementById('choices-container');

            // 1. Display Story Text (including roll result if present)
            storyOutput.innerHTML = prependContent + '<p>' + section.text + '</p>';
            
            // 2. Clear previous choices
            choicesContainer.innerHTML = '';
            
            // 3. Create and display new choices (if any)
            if (section.choices && section.choices.length > 0) {
                section.choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-button';
                    button.textContent = choice.text;
                    button.onclick = () => updatePage(choice.target); 
                    choicesContainer.appendChild(button);
                });
            } else {
                // Game Over state formatting
                storyOutput.innerHTML += '<p class="game-over">The adventure is complete! Click Refresh to play again.</p>';
            }
        }
        
        // --- INITIAL GAME START ---
        updatePage('start');
    </script>
</body>
</html>
